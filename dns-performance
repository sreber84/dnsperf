#!/bin/sh

MAX_TEST_SECONDS="${MAX_TEST_SECONDS:-60}"
DNS_SERVER_ADDR="${DNS_SERVER_ADDR:-172.30.0.10}"
DNS_SERVER_PORT=${DNS_SERVER_PORT:-53}
TRANSPORT_MODE="${TRANSPORT_MODE:-udp}"
MAX_QPS="${MAX_QPS:-1000}"
MAX_CLIENTS="${MAX_CLIENTS:-1}"
DNSPERF_RECORDS_INPUT="${DNSPERF_RECORDS_INPUT:-/opt/dns.txt}"

while [ true ]
  do
    echo `date`
    dnsperf -c ${MAX_CLIENTS} -l ${MAX_TEST_SECONDS} -s ${DNS_SERVER_ADDR} -p ${DNS_SERVER_PORT} -m ${TRANSPORT_MODE} -Q ${MAX_QPS} -d ${DNSPERF_RECORDS_INPUT}
done
